<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1050, user-scalable=no" />
    <title>Ceylon LUXE Demo</title>
    <link rel="icon" type="image/png" href="./pics/favicon.png" />
    <script src="./extras/jquery.min.1.7.js"></script>
    <script src="./extras/modernizr.2.5.3.min.js"></script>
    <script src="./extras/jquery.mousewheel.min.js"></script>
    <script src="./lib/hash.js"></script>
    <script src="js/magazine.js"></script>
    <link rel="stylesheet" href="css/magazine.css" />
  </head>
  <body>

	


    <!-- Magazine viewport -->
    <div class="magazine-viewport">
      <div class="container">
        <div class="magazine">
          <!-- Next button -->
          <div ignore="1" class="next-button"></div>
          <!-- Previous button -->
          <div ignore="1" class="previous-button"></div>
        </div>
      </div>
    </div>

    <!-- Thumbnails -->
    <div class="thumbnails">
      <div>
        <ul>
          <li class="i">
            <img src="pages/1-thumb.jpg" width="76" height="100" class="page-1" />
            <span>1</span>
          </li>
          <li class="d">
            <img src="pages/2-thumb.jpg" width="76" height="100" class="page-2" />
            <img src="pages/3-thumb.jpg" width="76" height="100" class="page-3" />
            <span>2-3</span>
          </li>
          <li class="d">
            <img src="pages/4-thumb.jpg" width="76" height="100" class="page-4" />
            <img src="pages/5-thumb.jpg" width="76" height="100" class="page-5" />
            <span>4-5</span>
          </li>
          <li class="d">
            <img src="pages/6-thumb.jpg" width="76" height="100" class="page-6" />
            <img src="pages/7-thumb.jpg" width="76" height="100" class="page-7" />
            <span>6-7</span>
          </li>
          <li class="d">
            <img src="pages/8-thumb.jpg" width="76" height="100" class="page-8" />
            <img src="pages/9-thumb.jpg" width="76" height="100" class="page-9" />
            <span>8-9</span>
          </li>
          <li class="d">
            <img src="pages/10-thumb.jpg" width="76" height="100" class="page-10" />
            <img src="pages/11-thumb.jpg" width="76" height="100" class="page-11" />
            <span>10-11</span>
          </li>
          <li class="i">
            <img src="pages/12-thumb.jpg" width="76" height="100" class="page-12" />
            <span>12</span>
          </li>
        </ul>
      </div>
    </div>

    <script>
      function loadApp() {
        $('#all').fadeIn(1000)

        // Create the flipbook
        $('.magazine').turn({
          width: 922,
          height: 600,
          elevation: 50,
          acceleration: !isChrome(),
          gradients: true,
          autoCenter: true,
          pages: 12,
          when: {
            turning: function (event, page) {
              var book = $(this),
                currentPage = book.turn('page')

              Hash.go('page/' + page).update()
              disableControls(page)

              $('.thumbnails .page-' + currentPage)
                .parent()
                .removeClass('current')
              $('.thumbnails .page-' + page)
                .parent()
                .addClass('current')
            },
            turned: function (event, page) {
              disableControls(page)
              $(this).turn('center')
              if (page === 1) {
                $(this).turn('peel', 'br')
              }
            },
            missing: function (event, pages) {
              for (var i = 0; i < pages.length; i++) {
                addPage(pages[i], $(this))
              }
            },
          },
        })

        // Zoom.js setup
        $('.magazine-viewport').zoom({
          flipbook: $('.magazine'),
          max: function () {
            return largeMagazineWidth() / $('.magazine').width()
          },
          when: {
            tap: function (event) {
              if ($(this).zoom('value') === 1) {
                $('.magazine').removeClass('animated').addClass('zoom-in')
                $(this).zoom('zoomIn', event)
              } else {
                $(this).zoom('zoomOut')
              }
            },
            zoomIn: function () {
              $('.thumbnails').hide()
              $('.magazine').addClass('zoom-in')
            },
            zoomOut: function () {
              $('.thumbnails').fadeIn()
              $('.magazine').addClass('animated').removeClass('zoom-in')
            },
            swipeLeft: function () {
              $('.magazine').turn('next')
            },
            swipeRight: function () {
              $('.magazine').turn('previous')
            },
          },
        })

        // Arrow key navigation
        $(document).keydown(function (e) {
          switch (e.keyCode) {
            case 37:
              $('.magazine').turn('previous')
              e.preventDefault()
              break
            case 39:
              $('.magazine').turn('next')
              e.preventDefault()
              break
            case 27:
              $('.magazine-viewport').zoom('zoomOut')
              e.preventDefault()
              break
          }
        })

        // Thumbnails click events
        $('.thumbnails').click(function (event) {
          var page
          if (event.target && (page = /page-([0-9]+)/.exec($(event.target).attr('class')))) {
            $('.magazine').turn('page', page[1])
          }
        })

        resizeViewport()
        $('.magazine').addClass('animated')
      }

      $('#all').hide()

      yepnope({
        test: Modernizr.csstransforms,
        yep: ['./lib/turn.min.js'],
        nope: ['./lib/turn.html4.min.js'],
        both: ['./lib/zoom.min.js'],
        complete: loadApp,
      })
    </script>
  </body>
</html>
